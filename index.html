<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>张家口地点地图</title>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=521420b7757cf96bb4ecb217e0699ad8"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            line-height: 1.8;
            padding: 10px;
            background-color: #f9f7f5;
        }
        #mapContainer {
            width: 100%;
            max-width: 1200px;
            height: 60vh;
            min-height: 400px;
            margin: 15px auto;
            display: none;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        #showMapBtn {
            padding: 12px 24px;
            font-size: 16px;
            margin: 15px auto;
            display: block;
            cursor: pointer;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            transition: background 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        #showMapBtn:hover, #showMapBtn:active {
            background: #c82333;
        }
        .info-content {
            max-height: 40vh;
            min-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .info-content::-webkit-scrollbar {
            width: 6px;
        }
        .info-content::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        .info-content::-webkit-scrollbar-track {
            background: #f5f5f5;
        }
        .img-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .img-group img {
            flex: 1;
            min-width: 100px;
            height: 160px;
            object-fit: cover;
            border-radius: 6px;
        }
        .info-video {
            width: 100%;
            height: 20vh;
            min-height: 180px;
            border-radius: 6px;
            margin-top: 8px;
            border: none;
        }
        .info-content h3 {
            margin: 0 0 8px 0;
            color: #dc3545;
            font-size: 18px;
        }
        .info-content p {
            margin: 8px 0;
            line-height: 1.6;
            font-size: 14px;
            color: #34495e;
        }
        .video-title {
            margin: 10px 0 5px 0;
            font-weight: bold;
            font-size: 15px;
        }
    </style>
</head>
<body>
    <button id="showMapBtn">点击显示张家口市地图</button>
    <div id="mapContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var showMapBtn = document.getElementById('showMapBtn');
            var mapContainer = document.getElementById('mapContainer');
            var map = null;

            showMapBtn.addEventListener('click', function() {
                mapContainer.style.display = 'block';
                if (!map) initMap();
            });

            function initMap() {
                try {
                    map = new AMap.Map('mapContainer', {
                        zoom: 11,
                        center: [114.8700, 40.8100],
                        resizeEnable: true,
                        scrollWheel: true,
                        touchZoom: true,
                        doubleClickZoom: true
                    });

                    // 修复红色标记图标：恢复清晰尺寸，调整偏移确保显示完整
                    var redMarkerIcon = new AMap.Icon({
                        size: new AMap.Size(30, 38), // 恢复原图标尺寸，确保清晰可见
                        image: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png', // 高德官方红色标记图标
                        imageSize: new AMap.Size(30, 38), // 与图标实际尺寸一致
                        imageOffset: new AMap.Pixel(-15, -38) // 偏移量设为图标一半，确保标记点在图标底部中心
                    });

                    var markersData = [
                        // 1. 张家口堡子里
                        {
                            position: [114.8685, 40.8220],
                            title: "张家口堡子里",
                            content: `
                                <div class="info-content" style="width: 90vw; max-width: 600px; padding: 8px; box-sizing: border-box;">
                                    <h3>张家口堡子里</h3>
                                    <p>作为张家口市的发祥地与城市“原点”，堡子里（当地读bǔ）承载着近600年的历史文脉，从明宣德年间建堡至今，700余处文物古迹、93处重点院落共同构成了“明清建筑博物馆”的鲜活底色。</p>
                                    <div class="img-group">
                                        <img src="1.1堡子里.jpg" alt="堡子里1" />
                                        <img src="1.2堡子里.jpg" alt="堡子里2" />
                                        <img src="1.3堡子里.jpg" alt="堡子里3" />
                                        <img src="1.4堡子里.jpg" alt="堡子里4" />
                                    </div>
                                    <p class="video-title">堡子里介绍视频</p>
                                    <iframe class="info-video" 
                                            src="https://player.bilibili.com/player.html?isOutside=true&aid=115308832492011&bvid=BV1NaH3z2E5Z&cid=32809944212&p=1" 
                                            scrolling="no" 
                                            frameborder="no" 
                                            allowfullscreen="true"
                                            allow="fullscreen; autoplay; encrypted-media; picture-in-picture"></iframe>
                                </div>
                            `
                        },

                        // 2. 大境门
                        {
                            position: [114.8578, 40.8365],
                            title: "大境门",
                            content: `
                                <div class="info-content" style="width: 90vw; max-width: 600px; padding: 8px; box-sizing: border-box;">
                                    <h3>大境门</h3>
                                    <p>作为万里长城四大名关之一，大境门以“万里长城第一门”的独特身份，成为社会主义核心价值观的生动载体。不同于其他关隘的“军事属性”，这里从明朝隆庆年间起便是“茶马互市”的边贸枢纽。</p>
                                    <div class="img-group">
                                        <img src="2.1大境门.jpg" alt="大境门1" />
                                        <img src="2.2大境门.jpg" alt="大境门2" />
                                        <img src="2.3大境门.jpg" alt="大境门3" />
                                    </div>
                                    <p class="video-title">大境门介绍视频</p>
                                    <iframe class="info-video" 
                                            src="https://player.bilibili.com/player.html?isOutside=true&aid=115308849268995&bvid=BV1KhH3z7Ech&cid=32809945259&p=1" 
                                            scrolling="no" 
                                            frameborder="no" 
                                            allowfullscreen="true"
                                            allow="fullscreen; autoplay; encrypted-media; picture-in-picture"></iframe>
                                </div>
                            `
                        },

                        // 3. 张家口地质博物馆
                        {
                            position: [114.8875, 40.7960],
                            title: "张家口地质博物馆",
                            content: `
                                <div class="info-content" style="width: 90vw; max-width: 600px; padding: 8px; box-sizing: border-box;">
                                    <h3>张家口地质博物馆</h3>
                                    <p>这座2019年开放的科普阵地，以“免费开放、全民共享”的姿态，将社会主义核心价值观融入每一次知识传递。馆内三至五层的常规展厅里，恐龙化石复原模型讲述地球演化，矿物标本展现自然奥秘。</p>
                                    <div class="img-group">
                                        <img src="3.1博物馆.jpg" alt="地质博物馆1" />
                                        <img src="3.2博物馆.jpg" alt="地质博物馆2" />
                                    </div>
                                    <p class="video-title">地质博物馆介绍视频</p>
                                    <iframe class="info-video" 
                                            src="https://player.bilibili.com/player.html?isOutside=true&aid=115308849268777&bvid=BV1NhH3z7EoY&cid=32809945861&p=1" 
                                            scrolling="no" 
                                            frameborder="no" 
                                            allowfullscreen="true"
                                            allow="fullscreen; autoplay; encrypted-media; picture-in-picture"></iframe>
                                </div>
                            `
                        },

                        // 4. 张家口市中级人民法院
                        {
                            position: [114.8920, 40.8080],
                            title: "张家口市中级人民法院",
                            content: `
                                <div class="info-content" style="width: 90vw; max-width: 600px; padding: 8px; box-sizing: border-box;">
                                    <h3>张家口市中级人民法院</h3>
                                    <p>从1949年华北人民法院下辖的地方司法机构，到如今拥有28个内设机构、17个基层法院的规范化体系，张家口市中级人民法院的发展，是我国“法治”建设的微观缩影。</p>
                                    <div class="img-group">
                                        <img src="4.1.jpg" alt="中级人民法院" />
                                    </div>
                                    <p class="video-title">法院相关视频</p>
                                    <iframe class="info-video" 
                                            src="https://player.bilibili.com/player.html?isOutside=true&aid=115308849267774&bvid=BV1KhH3z7E5f&cid=32809946439&p=1" 
                                            scrolling="no" 
                                            frameborder="no" 
                                            allowfullscreen="true"
                                            allow="fullscreen; autoplay; encrypted-media; picture-in-picture"></iframe>
                                </div>
                            `
                        }
                    ];

                    // 循环创建标记，确保每个标记都绑定图标和地图
                    markersData.forEach(function(item) {
                        try {
                            var marker = new AMap.Marker({
                                position: item.position,  // 标记坐标（必选）
                                title: item.title,        // 鼠标悬浮显示的标题
                                map: map,                 // 绑定到地图（必选，否则不显示）
                                icon: redMarkerIcon,      // 绑定红色图标（修复核心）
                                clickable: true,          // 允许点击（确保可触发信息窗口）
                                zIndex: 100               // 提高层级，避免被地图元素遮挡
                            });

                            var infoWindow = new AMap.InfoWindow({
                                content: item.content,
                                offset: new AMap.Pixel(0, -40), // 信息窗口向上偏移，避开标记
                                autoMove: true
                            });

                            marker.on('click', function() {
                                infoWindow.open(map, marker.getPosition());
                                map.setStatus({ scrollWheel: false });
                            });

                            infoWindow.on('close', function() {
                                map.setStatus({ scrollWheel: true });
                                var windowContainer = infoWindow.getContainer();
                                var videoElement = windowContainer.querySelector('.info-video');
                                if (videoElement) {
                                    videoElement.src = videoElement.src;
                                }
                            });
                        } catch (e) {
                            console.log('创建标记失败：', item.title, e);
                        }
                    });

                    // 添加地图控件
                    map.addControl(new AMap.Zoom({
                        position: 'RB',
                        zoomOffset: 1
                    }));
                    map.addControl(new AMap.Scale({
                        position: 'RB'
                    }));

                } catch (e) {
                    alert('地图加载失败，请检查网络后重试！');
                    console.log('地图初始化错误：', e);
                }
            }
        });
    </script>
</body>
</html>